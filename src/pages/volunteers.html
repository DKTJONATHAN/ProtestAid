<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volunteer Signup - ProtestAid Kenya</title>
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #volunteerFormContainer {
            min-height: 600px;
            position: relative;
        }
        .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto py-12 px-4">
        <div class="text-center mb-12">
            <h1 class="text-3xl font-bold text-blue-800">Volunteer Signup</h1>
            <p class="mt-4 text-gray-600">Join our network of medics, legal experts, and support volunteers</p>
        </div>

        <div id="volunteerFormContainer">
            <div class="loader">
                <i class="fas fa-spinner fa-spin text-4xl text-blue-600"></i>
            </div>
        </div>
    </div>

    <script type="module">
        import { useState } from 'https://cdn.skypack.dev/react@17';
        import { render } from 'https://cdn.skypack.dev/react-dom@17';

        const counties = [
            "Mombasa", "Kwale", "Kilifi", "Tana River", "Lamu", 
            "Taita Taveta", "Garissa", "Wajir", "Mandera", "Marsabit",
            "Isiolo", "Meru", "Tharaka-Nithi", "Embu", "Kitui",
            "Machakos", "Makueni", "Nyandarua", "Nyeri", "Kirinyaga",
            "Murang'a", "Kiambu", "Turkana", "West Pokot", "Samburu",
            "Trans Nzoia", "Uasin Gishu", "Elgeyo-Marakwet", "Nandi", "Baringo",
            "Laikipia", "Nakuru", "Narok", "Kajiado", "Kericho",
            "Bomet", "Kakamega", "Vihiga", "Bungoma", "Busia",
            "Siaya", "Kisumu", "Homa Bay", "Migori", "Kisii",
            "Nyamira", "Nairobi"
        ];

        function VolunteerForm() {
            const [submitted, setSubmitted] = useState(false);
            const [error, setError] = useState(null);
            const [isLoading, setIsLoading] = useState(false);

            const handleSubmit = async (event) => {
                event.preventDefault();
                setIsLoading(true);
                
                const form = event.target;
                const formData = new FormData(form);
                const formValues = Object.fromEntries(formData.entries());
                
                formValues.experience = [...form.querySelectorAll('input[name="experience"]:checked')].map(el => el.value);
                formValues.certifications = [...form.querySelectorAll('input[name="certifications"]:checked')].map(el => el.value);

                try {
                    const response = await fetch('/.netlify/functions/volunteers', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formValues)
                    });

                    if (!response.ok) throw new Error('Submission failed');
                    
                    setSubmitted(true);
                    form.reset();
                } catch (err) {
                    setError('Failed to submit. Please try again.');
                    console.error(err);
                } finally {
                    setIsLoading(false);
                }
            };

            if (submitted) {
                return (
                    <div className="mt-8 bg-green-50 border border-green-200 rounded-md p-4">
                        <div className="flex">
                            <div className="flex-shrink-0">
                                <i className="fas fa-check-circle text-green-400"></i>
                            </div>
                            <div className="ml-3">
                                <h3 className="text-sm font-medium text-green-800">Thank you for volunteering!</h3>
                                <div className="mt-2 text-sm text-green-700">
                                    <p>Your information has been saved. We'll contact you soon.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <form onSubmit={handleSubmit} className="bg-white shadow-md rounded-lg p-8">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* Personal Information */}
                        <div className="col-span-2">
                            <h2 className="text-xl font-semibold text-gray-800 mb-4">Personal Information</h2>
                            <div className="space-y-4">
                                <div>
                                    <label htmlFor="fullName" className="block text-sm font-medium text-gray-700">Full Name</label>
                                    <input type="text" id="fullName" name="fullName" required 
                                           className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"/>
                                </div>
                                <div>
                                    <label htmlFor="email" className="block text-sm font-medium text-gray-700">Email</label>
                                    <input type="email" id="email" name="email" required 
                                           className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"/>
                                </div>
                                <div>
                                    <label htmlFor="phone" className="block text-sm font-medium text-gray-700">Phone Number</label>
                                    <input type="tel" id="phone" name="phone" required 
                                           className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"/>
                                </div>
                                <div>
                                    <label htmlFor="location" className="block text-sm font-medium text-gray-700">County</label>
                                    <select id="location" name="location" required 
                                            className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select your county</option>
                                        {counties.map(county => (
                                            <option key={county} value={county}>{county}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                        </div>

                        {/* Volunteer Role */}
                        <div>
                            <h2 className="text-xl font-semibold text-gray-800 mb-4">Volunteer Role</h2>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700">Service Type</label>
                                    <div className="mt-2 space-y-2">
                                        <div className="flex items-center">
                                            <input id="medic" name="serviceType" type="radio" value="medic" required 
                                                   className="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300"/>
                                            <label htmlFor="medic" className="ml-3 block text-sm font-medium text-gray-700">Medical Professional</label>
                                        </div>
                                        <div className="flex items-center">
                                            <input id="legal" name="serviceType" type="radio" value="legal" 
                                                   className="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300"/>
                                            <label htmlFor="legal" className="ml-3 block text-sm font-medium text-gray-700">Legal Expert</label>
                                        </div>
                                        <div className="flex items-center">
                                            <input id="logistics" name="serviceType" type="radio" value="logistics" 
                                                   className="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300"/>
                                            <label htmlFor="logistics" className="ml-3 block text-sm font-medium text-gray-700">Logistics/Driver</label>
                                        </div>
                                        <div className="flex items-center">
                                            <input id="other" name="serviceType" type="radio" value="other" 
                                                   className="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300"/>
                                            <label htmlFor="other" className="ml-3 block text-sm font-medium text-gray-700">Other Support</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Emergency Contacts */}
                        <div>
                            <h2 className="text-xl font-semibold text-gray-800 mb-4">Emergency Contacts</h2>
                            <div className="space-y-4">
                                <div>
                                    <label htmlFor="emergencyContact1" className="block text-sm font-medium text-gray-700">Primary Contact</label>
                                    <input type="text" id="emergencyContact1" name="emergencyContact1" required 
                                           className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"/>
                                </div>
                                <div>
                                    <label htmlFor="emergencyContact2" className="block text-sm font-medium text-gray-700">Secondary Contact</label>
                                    <input type="text" id="emergencyContact2" name="emergencyContact2" 
                                           className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"/>
                                </div>
                                <div>
                                    <label htmlFor="availability" className="block text-sm font-medium text-gray-700">Availability</label>
                                    <select id="availability" name="availability" required 
                                            className="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <option value="">Select availability</option>
                                        <option value="full-time">Full-time during protests</option>
                                        <option value="part-time">Part-time (specific hours)</option>
                                        <option value="on-call">On-call basis</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        {/* Additional Information */}
                        <div className="col-span-2">
                            <h2 className="text-xl font-semibold text-gray-800 mb-4">Additional Information</h2>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Experience</label>
                                    <div className="space-y-2">
                                        <div className="flex items-center">
                                            <input id="exp-medical" name="experience" type="checkbox" value="medical" 
                                                   className="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                            <label htmlFor="exp-medical" className="ml-3 block text-sm text-gray-700">Medical/First Aid</label>
                                        </div>
                                        <div className="flex items-center">
                                            <input id="exp-legal" name="experience" type="checkbox" value="legal" 
                                                   className="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                            <label htmlFor="exp-legal" className="ml-3 block text-sm text-gray-700">Legal Assistance</label>
                                        </div>
                                        <div className="flex items-center">
                                            <input id="exp-counseling" name="experience" type="checkbox" value="counseling" 
                                                   className="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                            <label htmlFor="exp-counseling" className="ml-3 block text-sm text-gray-700">Counseling</label>
                                        </div>
                                        <div className="flex items-center">
                                            <input id="exp-logistics" name="experience" type="checkbox" value="logistics" 
                                                   className="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                            <label htmlFor="exp-logistics" className="ml-3 block text-sm text-gray-700">Logistics/Transport</label>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Certifications</label>
                                    <div className="space-y-2">
                                        <div className="flex items-center">
                                            <input id="cert-firstaid" name="certifications" type="checkbox" value="firstaid" 
                                                   className="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                            <label htmlFor="cert-firstaid" className="ml-3 block text-sm text-gray-700">First Aid Certified</label>
                                        </div>
                                        <div className="flex items-center">
                                            <input id="cert-legal" name="certifications" type="checkbox" value="legal" 
                                                   className="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                            <label htmlFor="cert-legal" className="ml-3 block text-sm text-gray-700">Legal Training</label>
                                        </div>
                                        <div className="flex items-center">
                                            <input id="cert-crisis" name="certifications" type="checkbox" value="crisis" 
                                                   className="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"/>
                                            <label htmlFor="cert-crisis" className="ml-3 block text-sm text-gray-700">Crisis Management</label>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex items-start">
                                    <div className="flex items-center h-5">
                                        <input id="consent" name="consent" type="checkbox" required 
                                               className="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"/>
                                    </div>
                                    <div className="ml-3 text-sm">
                                        <label htmlFor="consent" className="font-medium text-gray-700">I consent to my information being stored and used for protest emergency response purposes</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="mt-8 flex justify-end">
                        <button type="submit" disabled={isLoading}
                                className={`inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white ${isLoading ? 'bg-blue-400' : 'bg-blue-600 hover:bg-blue-700'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`}>
                            {isLoading ? (
                                <>
                                    <i className="fas fa-spinner fa-spin mr-2"></i>
                                    Submitting...
                                </>
                            ) : 'Submit Volunteer Application'}
                        </button>
                    </div>
                </form>
            );
        }

        document.addEventListener('DOMContentLoaded', () => {
            render(<VolunteerForm />, document.getElementById('volunteerFormContainer'));
        });
    </script>
</body>
</html>